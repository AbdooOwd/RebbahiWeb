---
import Layout from "../layouts/Layout.astro";
---

<Layout title="Nouvelle Annonce">
    <div class="main">
        <div class="account" id="account-page">
            <h1>Entrez le mot-de-passe</h1>
            <input id="password" type="text" placeholder="Mot de passe..." />
            <button id="password-btn">Entrer</button>
            <span id="error"></span>
        </div>

        <div class="editor" id="editor-page">
            <h2>Poster une annonce</h2>
            <form>
                <input
                    type="text"
                    id="title"
                    placeholder="Titre"
                    required
                />
                <br />
                <textarea
                    id="content"
                    rows="20"
                    placeholder="Contenu de l'annonce"
                    required></textarea>
                <br />
                <button id="post-btn">Post</button>
            </form>
        </div>
    </div>
</Layout>

<style>
    .main {
        padding: 5vh 3vw;
    }

    .account {
        display: block;
    }

    .editor {
        display: none;
    }

    #title {
        width: 40%;
        font-size: larger;
        margin-bottom: 2vh;
    }

    #content {
        font-size: 0.8rem;
        resize: none;
        width: 75%;
        margin-bottom: 2vh;
    }

    #post-btn {
        cursor: pointer;
        padding: 2vh 10vw;
    }
</style>

<script>
    const password = document.getElementById("password") as HTMLInputElement;
    const password_btn = document.getElementById("password-btn");

    const account = document.getElementById("account-page") as HTMLDivElement;
    const editor = document.getElementById("editor-page") as HTMLDivElement;

    const error_boy = document.getElementById("error") as HTMLSpanElement;

    const post_btn = document.getElementById('post-btn') as HTMLButtonElement;

    post_btn.addEventListener('click', function() {
        handleSubmit();
    });

    function handleSubmit() {
        const title = document.getElementById("title")?.value;
        const content = document.getElementById("content")?.value;

        // Make the API call to store the post
        fetch('/api/submit', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ title, content }),
        })
        .then(response => response.json())
        .then(data => {
            // Handle the response, for example, show a success message
            console.log('Post submitted successfully:', data);
            alert('Post submitted successfully!');
        })
        .catch(error => {
            // Handle errors, for example, show an error message
            console.error('Error submitting post:', error);
            alert('Error submitting post. Please try again.');
        });
    };

    password_btn?.addEventListener("click", function () {
        let lePass = password?.value;
        if (lePass == "directeur") {
            account.style.display = "none";
            editor.style.display = "block";
        } else {
            error_boy.innerText = " Mauvais mot de passe!";
        }
    });
</script>